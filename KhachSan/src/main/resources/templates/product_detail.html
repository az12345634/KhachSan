<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/head :: head"></head>
<body>
<!-- start cssload-loader -->
<div class="preloader" id="preloader">
    <div class="loader">
        <svg class="spinner" viewBox="0 0 50 50">
            <circle
                    class="path"
                    cx="25"
                    cy="25"
                    r="20"
                    fill="none"
                    stroke-width="5"
            ></circle>
        </svg>
    </div>
</div>
<div th:replace="layout/header :: header"></div>
<section class="breadcrumb-top-bar">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb-list breadcrumb-top-list">
                    <ul class="list-items bg-transparent radius-none p-0">
                        <li><a href="index.html">Home</a></li>
                        <li>France</li>
                        <li>Hilton Hotel and Resorts</li>
                    </ul>
                </div>
                <!-- end breadcrumb-list -->
            </div>
            <!-- end col-lg-12 -->
        </div>
        <!-- end row -->
    </div>
    <!-- end container -->
</section>

<section class="breadcrumb-area bread-bg-7 py-0">
    <div class="breadcrumb-wrap">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb-btn">
                        <div  class="btn-box btn-boxx">
                            <a
                                    class="theme-btn"
                                    data-src="/frontend/images/img1.jpg"
                                    data-fancybox="gallery"
                                    data-caption="Showing image - 01"
                                    data-speed="700">
                                <i class="la la-photo me-2"></i>More Photos
                            </a>

                </div>
                <!-- end col-lg-12 -->
            </div>
            <!-- end row -->
        </div>
        <!-- end container -->
    </div>
    <!-- end breadcrumb-wrap -->
</section>

<section class="tour-detail-area padding-bottom-90px">
    <div
            class="single-content-navbar-wrap menu section-bg"
            id="single-content-navbar">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="single-content-nav" id="single-content-nav">
                        <ul>
                            <li>
                                <a
                                        data-scroll="description"
                                        href="#description"
                                        class="scroll-link active"
                                >Hotel Details</a>
                            </li>

                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end single-content-navbar-wrap -->
    <div class="single-content-box">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="single-content-wrap padding-top-60px">
                        <div id="description" class="page-scroll">
                            <div class="single-content-item pb-4">
                                <h3 class="title titlee font-size-26">Hilton Hotel and Resorts</h3>
                                <h3 class="title" style="margin: 10px; color: #9a6e3a">Giới thiệu khách sạn </h3>
                                <p id="shortDes" ></p>
                            </div>
                            <!-- end single-content-item -->
                            <div class="section-block"></div>
                            <div class="single-content-item py-4">
                                <div class="row">
                                    <div class="col-lg-4 responsive-column">
                                        <div class="single-tour-feature d-flex align-items-center mb-3">
                                            <div class="single-feature-icon icon-element ms-0 flex-shrink-0 me-3">
                                                <i class="la la-hotel"></i>
                                            </div>
                                            <div class="single-feature-titles">
                                                <h3 class="title font-size-15 font-weight-medium">
                                                    Hotel Type
                                                </h3>
                                                <span class="font-size-13">4 Star</span>
                                            </div>
                                        </div>
                                        <!-- end single-tour-feature -->
                                    </div>
                                    <!-- end col-lg-4 -->
                                    <div class="col-lg-4 responsive-column">
                                        <div
                                                class="single-tour-feature d-flex align-items-center mb-3"
                                        >
                                            <div
                                                    class="single-feature-icon icon-element ms-0 flex-shrink-0 me-3"
                                            >
                                                <i class="la la-user"></i>
                                            </div>
                                            <div class="single-feature-titles">
                                                <h3 class="title font-size-15 font-weight-medium">
                                                    Extra People
                                                </h3>
                                                <span class="font-size-13">No Charge</span>
                                            </div>
                                        </div>
                                        <!-- end single-tour-feature -->
                                    </div>
                                    <!-- end col-lg-4 -->
                                    <div class="col-lg-4 responsive-column">
                                        <div
                                                class="single-tour-feature d-flex align-items-center mb-3"
                                        >
                                            <div
                                                    class="single-feature-icon icon-element ms-0 flex-shrink-0 me-3"
                                            >
                                                <i class="la la-bed"></i>
                                            </div>
                                            <div class="single-feature-titles">
                                                <h3 class="title font-size-15 font-weight-medium">
                                                    Minimum Stay
                                                </h3>
                                                <span class="font-size-13">2 Nights</span>
                                            </div>
                                        </div>
                                        <!-- end single-tour-feature -->
                                    </div>
                                    <!-- end col-lg-4 -->
                                    <div class="col-lg-4 responsive-column">
                                        <div
                                                class="single-tour-feature d-flex align-items-center mb-3"
                                        >
                                            <div
                                                    class="single-feature-icon icon-element ms-0 flex-shrink-0 me-3"
                                            >
                                                <i class="la la-money"></i>
                                            </div>
                                            <div class="single-feature-titles">
                                                <h3 class="title font-size-15 font-weight-medium">
                                                    Security Deposit
                                                </h3>
                                                <span class="font-size-13">$279</span>
                                            </div>
                                        </div>
                                        <!-- end single-tour-feature -->
                                    </div>
                                    <!-- end col-lg-4 -->
                                    <div class="col-lg-4 responsive-column">
                                        <div
                                                class="single-tour-feature d-flex align-items-center mb-3"
                                        >
                                            <div
                                                    class="single-feature-icon icon-element ms-0 flex-shrink-0 me-3"
                                            >
                                                <i class="la la-globe"></i>
                                            </div>
                                            <div class="single-feature-titles">
                                                <h3 class="title font-size-15 font-weight-medium">
                                                    Country
                                                </h3>
                                                <span class="font-size-13">France</span>
                                            </div>
                                        </div>
                                        <!-- end single-tour-feature -->
                                    </div>


                                </div>
                                <!-- end row -->
                            </div>
                            <!-- end single-content-item -->
                            <div class="section-block"></div>
                            <div  class="single-content-item padding-top-40px padding-bottom-40px">
                                <h3 class="title titlee font-size-20"></h3>
                                <h4 class="title" style="margin: 10px; color: #9a6e3a">Mô Tả khách sạn </h4>
                                <p id="pills-home" class="py-3">
                                    Per consequat adolescens ex, cu nibh commune temporibus
                                    vim, ad sumo viris eloquentiam sed. Mea appareat
                                    omittantur eloquentiam ad, nam ei quas oportere
                                    democritum. Prima causae admodum id est, ei timeam
                                    inimicus sed. Sit an meis aliquam, cetero inermis vel ut.
                                    An sit illum euismod facilisis, tamquam vulputate
                                    pertinacia eum at.
                                </p>
                            </div>
                            <!-- end single-content-item -->
                            <div class="section-block"></div>
                        </div>



                        <div class="review-box">
                            <div class="single-content-item padding-top-40px">
                                <h3 class="title font-size-20">Đánh giá khách sạn</h3>
                                <div class="comments-list padding-top-50px">
                                    <div class="comment">
                                        <div class="comment-body">
                                            <div class="meta-data">
                                                <h3 class="comment__author">Jenny Doe</h3>
<!--                                                <div class="meta-data-inner d-flex">-->
<!--                              -->
<!--                                                    <p class="comment__date">April 5, 2019</p>-->
<!--                                                </div>-->
                                            </div>
                                            <p class="comment-content">
                                                Lorem ipsum dolor sit amet, dolores mandamus
                                                moderatius ea ius, sed civibus vivendum imperdiet
                                                ei, amet tritani sea id. Ut veri diceret fierent
                                                mei, qui facilisi suavitate euripidis
                                            </p>

                                        </div>
                                    </div>
                                    <!-- end comments -->


                                    <div class="btn-box load-more text-center">
                                        <button
                                                class="theme-btn theme-btn-small theme-btn-transparent"
                                                type="button"
                                        >
                                            Load More Review
                                        </button>
                                    </div>
                                </div>
                                <!-- end comments-list -->

                                <!-- end comment-forum -->
                            </div>
                            <!-- end single-content-item -->
                        </div>
                        <!-- end review-box -->
                    </div>
                    <!-- end single-content-wrap -->
                </div>

<!--                // phần này hiển thị chi tiết sản phẩm-->
                <div class="col-lg-4">
                    <div class="sidebar single-content-sidebar mb-0">
                        <div class="sidebar-widget single-content-widget">
                            <div class="sidebar-widget-item">
                                <div  class="sidebar-book-title-wrap mb-3">
                                    <h3>Thông tin phòng</h3>
                                    <p>
                        <span class="text-form">Giá</span
                        ><span id="price" class="text-value ms-2 me-1">$399.00</span>
                                    </p>
                                </div>
                            </div>
                            <!-- end sidebar-widget-item -->
                            <div class="sidebar-widget-item">
                                <div class="contact-form-action">
                                    <form action="#">
                                        <div class="input-box">
                                            <label class="label-text">Loại khách sạn</label>
                                            <div class="form-group select2-container-wrapper">
                                                <h3 id="cate" style="margin: 10px; color: #9a6e3a"> </h3>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <!-- end sidebar-widget-item -->
                            <div class="sidebar-widget-item">
                                <div class="qty-box mb-2 d-flex align-items-center justify-content-between">
                                    <label class="font-size-16">Số lượng </label>
                                    <div class="qtyBtn d-flex align-items-center">
                                        <button name="qtt-0"  onclick="minusQuantity(this.name, this.value)" value="1" class="minus-btn" type="button">
                                            <i class="la la-minus"></i></button>
                                        <input type="text" onchange="changeQuantity(this.name,this.value)" name="qtt-0" value="1">
                                        <button name="qtt-0" onclick="plusQuantity(this.name, this.value)" value="1" class="plus-btn" type="button">
                                            <i class="la la-plus"></i></button>
                                    </div>
                                </div>

                            </div>

                            <div class="btn-box pt-2">
                                <a id="createBooking" class="theme-btn text-center w-100 mb-2">
                                    <i class="la la-shopping-cart me-2 font-size-18"></i>Book Now
                                </a>
                            </div>

                        </div>

                    </div>
                    <!-- end sidebar -->
                </div>
                <!-- end col-lg-4 -->
            </div>
            <!-- end row -->
        </div>
        <!-- end container -->
    </div>
    <!-- end single-content-box -->
</section>


<footer th:replace="layout/footer :: footer"></footer>

<div th:replace="layout/script :: script"></div>

<script>
    initProductDetail();
    clickBooking();

    // Biến toàn cục để lưu giá sản phẩm
    let currentProductPrice = 0;

    function getProduct(objectFilter, loadImg) {
        $.ajax({
            type: "POST",
            url: HOST + "/api/product/detail",
            contentType: "application/json",
            data: JSON.stringify(objectFilter),
            dataType: "json",
            success: function (response) {
                const productData = response.data;

                if (!productData) {
                    console.error("Product data is missing.");
                    return;
                }

                // Lấy giá sản phẩm từ API
                currentProductPrice = productData.price;

                // Format giá và hiển thị trên giao diện
                let price = formatPrice(currentProductPrice) + ' VNĐ';
                let priceHtml = '<span name="priceProduct" data-value="' + currentProductPrice + '">' + price + '</span>';
                $('#price').html(priceHtml);

                let img =
                    '<a class="theme-btn" ' +
                    'data-src="' + productData.image + '" ' +
                    'data-fancybox="gallery" ' +
                    'data-caption="Showing image - Updated" ' +
                    'data-speed="700">' +
                    '<i class="la la-photo me-2"></i>More Photos' +
                    '</a>';

                $('.btn-boxx').html(img);

                let nameProductHtml = '<span name="nameProduct" data-value="' + productData.id + '">' + productData.name + '</span>';
                $('.titlee').html(nameProductHtml);

                $('#shortDes').html('<p>' + productData.shortDescription + '</p>');
                $('#pills-home').html('<p>' + productData.description + '</p>');
                $('#cate').html('<a href="#" class="link-oragne">' + productData.category + '</a>');

                // changeSize();
            },
            error: function (error) {
                console.log(error);
            }
        });
    }
    function clickBooking() {
        $('#createBooking').click(function () {
            let quantity = $('input[type="text"][name="qtt-0"]').val();
            let price = currentProductPrice; // Lấy giá từ biến toàn cục
            let productId = $('span[name=nameProduct]').data("value");

            // Kiểm tra giá hợp lệ (số và khác 0)
            if ($.isNumeric(price) && price !== 0) {
                let totalOneP = price * quantity; // Tính tổng giá trị của sản phẩm
                console.log(quantity, price, totalOneP, productId);

                let objCart = {
                    productId: productId,
                    quantity: quantity,
                    totalOneP: totalOneP
                };

                // Gọi hàm tạo booking
                createBooking(objCart);
            } else {
                alertInfo("", "Giá sản phẩm không hợp lệ hoặc chưa chọn số lượng", "error");
            }
        });
    }

    function createBooking(objCart) {
        $.ajax({
            type: "POST",
            url: "http://localhost:8080/api/cart/add-to-cart",
            contentType: "application/json",
            data: JSON.stringify(objCart),
            dataType: "json",
            success: function (response) {
                console.log(response);
                if (response.code === 200) {
                    alertInfo("", "Bạn đã Đặt phòng thành công", "success");
                    countCart(); // Cập nhật giỏ hàng

                    // Chuyển hướng đến trang giỏ hàng sau khi đặt phòng thành công
                    setTimeout(function () {
                        window.location.href = "http://localhost:8080/views/cart";
                    }, 1500); // Chờ 1.5s để hiển thị thông báo trước khi chuyển trang
                } else {
                    window.location.href = "http://localhost:8080/login"; // Nếu lỗi, chuyển đến trang đăng nhập
                }
            },
            error: function (error) {
                console.log(error);
                alertInfo("", "Đã có lỗi xảy ra. Vui lòng thử lại", "error");
            }
        });
    }


    function initProductDetail() {
        let codeProduct = getCode();
        let objFilter = {
            code: codeProduct
        };
        getProduct(objFilter, true);
    }

    function formatPrice(price) {
        return price ? price.toLocaleString('vi-VN', { style: 'decimal', minimumFractionDigits: 0 }) : 'N/A';
    }


</script>

</body>
</html>
